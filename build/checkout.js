(()=>{"use strict";!function(e,t){new class{constructor(){t.addEventListener("DOMContentLoaded",(()=>{this.init()}))}init(){this.bindEvents()}bindEvents(){e(t).on("input","#gifty_cart_code",this.handleGiftCardCodeInput.bind(this)),e(t).on("keypress","#gifty_cart_code",this.handleGiftCardCodeInput.bind(this)),e(t).on("click","#gifty_cart_submit",this.handleGiftCardSubmit.bind(this)),e(t).on("click",".gifty-gift-card-remove",this.handleGiftCardRemove.bind(this))}displayCartNotice(e,s){const o=s||"success",i=t.getElementById("gifty_gift_card_notices_wrapper")||t.querySelector(".woocommerce-notices-wrapper");if(i.innerHTML="",""===e)return;const a=t.createElement("div");a.classList.add("woocommerce-"+o),a.innerHTML+=e,i.appendChild(a),i.scrollIntoView(),setTimeout((()=>{i.innerHTML=""}),8e3)}handleGiftCardCodeInput(s){13===s.which&&(s.preventDefault(),e("#gifty_cart_submit").click()),t.getElementById("gifty_cart_code").value.length<16?t.getElementById("gifty_cart_submit").disabled=!0:t.getElementById("gifty_cart_submit").disabled=!1}handleGiftCardSubmit(s){s.preventDefault(),this.block(e("div.cart_totals")),this.block(e("div.woocommerce-checkout-review-order"));const o=t.getElementById("gifty_cart_code").value.replace(/[^a-zA-Z0-9]/g,""),i=new FormData;i.append("action","gifty_apply_gift_card"),i.append("security",wc_params.apply_gift_card_nonce),i.append("card_code",o);const a=new XMLHttpRequest;a.open("POST",wc_params.ajax_url),a.responseType="json",a.send(i),a.onload=()=>{if(a.status<200||a.status>=300||!1===a.response?.success){const e=a.response?.data||a.response;this.displayCartNotice(e,"error")}else t.getElementById("gifty_cart_code").value="",e(t.body).trigger("wc_update_cart"),e(t.body).trigger("update_checkout",{update_shipping_method:!1}),this.displayCartNotice(a.response?.data,"message")},a.onloadend=()=>{this.unblock(e("div.cart_totals")),this.unblock(e("div.woocommerce-checkout-review-order"))}}handleGiftCardRemove(s){this.block(e("div.cart_totals")),this.block(e("div.woocommerce-checkout-review-order"));const o=s.target.dataset.giftCardId,i=new FormData;i.append("action","gifty_remove_gift_card"),i.append("security",wc_params.remove_gift_card_nonce),i.append("card_id",o);const a=new XMLHttpRequest;a.open("POST",wc_params.ajax_url),a.responseType="json",a.send(i),a.onload=()=>{if(a.status<200||a.status>=300||!1===a.response?.success){const e=a.response?.data||a.response;this.displayCartNotice(e,"error")}else this.displayCartNotice(a.response?.data,"message"),e(t.body).trigger("wc_update_cart"),e(t.body).trigger("update_checkout",{update_shipping_method:!1})},a.onloadend=()=>{this.unblock(e("div.cart_totals")),this.unblock(e("div.woocommerce-checkout-review-order"))}}is_blocked(e){return e.is(".processing")||e.parents(".processing").length}block(e){this.is_blocked(e)||e.addClass("processing").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})}unblock(e){e.removeClass("processing").unblock()}}}(jQuery,document)})();